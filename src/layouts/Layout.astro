---
interface Props {
  title?: string;
  description?: string;
}

const {
  title = 'Raveen Savinda Rathnayake — Software Engineer',
  description = 'Personal portfolio of Raveen Savinda Rathnayake — Associate Technical Lead at WSO2, Software Engineer, and Knowledge Sharer.',
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <meta name="author" content="Raveen Savinda Rathnayake" />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://raveen.me" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />

    <title>{title}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Theme script (runs before render to prevent flash) -->
    <script is:inline>
      (function () {
        const stored = localStorage.getItem('theme');
        if (stored) {
          document.documentElement.setAttribute('data-theme', stored);
        }
      })();
    </script>
  </head>
  <body>
    <div class="container">
      <slot />
    </div>

    <!-- Konami code overlay -->
    <div id="checkered-overlay" class="checkered-overlay" aria-hidden="true"></div>
    <div id="konami-badge" class="konami-badge" aria-hidden="true">3</div>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';

  .checkered-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    pointer-events: none;
    opacity: 0;
    background: repeating-conic-gradient(#111 0% 25%, #fff 0% 50%) 0 0 / 40px 40px;
    transition: opacity 0.3s ease;
  }

  .checkered-overlay.flash {
    animation: checkered-flash 0.8s ease-out;
  }

  @keyframes checkered-flash {
    0% { opacity: 0.9; }
    100% { opacity: 0; }
  }

  .konami-badge {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 10000;
    background: #e30613;
    color: #fff;
    font-weight: 700;
    font-size: 1.2rem;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none;
    font-family: var(--font-mono, ui-monospace, monospace);
  }

  .konami-badge.visible {
    opacity: 1;
    transform: scale(1);
  }
</style>

<script>
  // --- Console message ---
  console.log(
    '%c\u{1F3CE}\uFE0F Sector 1: Clear\n\u{1F3C1} "Simply simply lovely"\n#3 // If you found this, we\'d get along.',
    'color: #e30613; font-size: 12px; font-weight: bold;'
  );

  // --- Tab title easter egg ---
  (function () {
    const originalTitle = document.title;
    document.addEventListener('visibilitychange', () => {
      document.title = document.hidden ? 'Box Box! \u{1F6DE}' : originalTitle;
    });
  })();

  // --- Konami code easter egg ---
  (function () {
    const code = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
    let index = 0;

    document.addEventListener('keydown', (e) => {
      const key = e.key.length === 1 ? e.key.toLowerCase() : e.key;
      if (key === code[index]) {
        index++;
        if (index === code.length) {
          index = 0;
          activateF1Mode();
        }
      } else {
        index = e.key === code[0] ? 1 : 0;
      }
    });

    function activateF1Mode() {
      console.log('Box box box! \u{1F3C1} Welcome to the grid.');

      // Checkered flag flash
      const overlay = document.getElementById('checkered-overlay');
      if (overlay) {
        overlay.classList.remove('flash');
        void overlay.offsetWidth; // force reflow
        overlay.classList.add('flash');
      }

      // Show #3 badge
      const badge = document.getElementById('konami-badge');
      if (badge) {
        badge.classList.add('visible');
        setTimeout(() => badge.classList.remove('visible'), 4000);
      }

      // Shift accent to Red Bull red
      document.documentElement.style.setProperty('--accent', '#e30613');
      document.documentElement.style.setProperty('--accent-hover', '#c00510');

      setTimeout(() => {
        document.documentElement.style.removeProperty('--accent');
        document.documentElement.style.removeProperty('--accent-hover');
      }, 10000);
    }
  })();
</script>
